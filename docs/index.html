<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pythonã‚²ãƒ¼ãƒ é–‹ç™º ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å­¦ç¿’ç’°å¢ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-in;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            backdrop-filter: blur(10px);
        }

        .level-badge {
            display: inline-block;
            background: #ffd700;
            color: #333;
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            margin-left: 10px;
        }

        .xp-bar {
            width: 200px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .xp-progress {
            height: 100%;
            background: #4caf50;
            transition: width 0.5s ease;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .sidebar {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .chapter-list {
            list-style: none;
        }

        .chapter-item {
            padding: 10px;
            margin: 5px 0;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .chapter-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .chapter-item.active {
            background: #667eea;
            color: white;
        }

        .chapter-item.completed::after {
            content: 'âœ“';
            position: absolute;
            right: 10px;
            color: #4caf50;
            font-weight: bold;
            font-size: 18px;
        }

        .chapter-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chapter-item.locked::after {
            content: 'ğŸ”’';
            position: absolute;
            right: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideUp 0.5s ease-out;
        }

        .card.full-width {
            grid-column: 1 / -1;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .difficulty-indicator {
            display: flex;
            gap: 5px;
        }

        .difficulty-star {
            font-size: 20px;
            color: #ddd;
        }

        .difficulty-star.active {
            color: #ffd700;
        }

        .code-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .code-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            font-size: 14px;
        }

        .code-tab:hover {
            background: #f5f5f5;
        }

        .code-tab.active {
            color: #667eea;
            font-weight: bold;
        }

        .code-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .code-editor-wrapper {
            position: relative;
            margin-bottom: 15px;
            display: flex;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: #f0f0f0;
        }

        .line-numbers {
            background: #f0f0f0;
            padding: 15px 10px;
            color: #999;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 21px;
            user-select: none;
            text-align: right;
            min-width: 45px;
            width: 45px;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤º */
        .line-numbers::-webkit-scrollbar {
            width: 0;
            display: none;
        }

        .code-editor {
            flex: 1;
            min-height: 300px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: none;
            background: #f8f8f8;
            resize: none; /* flexboxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ãŸã‚ã€ãƒªã‚µã‚¤ã‚ºã‚’ç„¡åŠ¹åŒ– */
            line-height: 21px;
            tab-size: 4;
            outline: none;
            overflow-y: auto;
        }

        .code-editor-wrapper:focus-within {
            border-color: #667eea;
        }

        .code-editor-wrapper:focus-within .code-editor {
            background: white;
        }

        .comparison-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .comparison-box {
            padding: 15px;
            border-radius: 8px;
            background: #f5f5f5;
        }

        .comparison-box.scratch {
            background: #ffeb3b1a;
            border: 2px solid #ffc107;
        }

        .comparison-box.python {
            background: #4caf501a;
            border: 2px solid #4caf50;
        }

        .comparison-box h4 {
            margin-bottom: 10px;
            color: #555;
        }

        .comparison-box pre {
            margin: 0;
            font-size: 13px;
        }

        .visual-explanation {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .memory-visualization {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .memory-box {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            min-width: 120px;
            text-align: center;
            animation: fadeIn 0.5s;
            transition: all 0.3s;
        }

        .memory-box.highlight {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .memory-box .var-name {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .memory-box .var-value {
            font-size: 1.2em;
            font-family: monospace;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-primary {
            background: #4caf50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-secondary {
            background: #fbc02d;
            color: #333;
        }

        .btn-secondary:hover {
            background: #f9a825;
            box-shadow: 0 5px 15px rgba(251, 192, 45, 0.3);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .output-area {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
            max-height: 400px;
            line-height: 1.5;
        }

        .output-area.error {
            color: #ff5252;
        }

        .output-area .input-prompt {
            color: #64b5f6;
        }

        .output-area .output-line {
            margin: 2px 0;
        }

        .hint-system {
            margin-top: 20px;
        }

        .hint-level {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .hint-button {
            flex: 1;
            padding: 10px;
            background: #e0e0e0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .hint-button:hover:not(.revealed) {
            background: #fbc02d;
        }

        .hint-button.revealed {
            background: #4caf50;
            color: white;
        }

        .hint-content {
            background: #fff9c4;
            border-left: 4px solid #fbc02d;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
        }

        .hint-content.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .test-cases {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .test-case {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin: 8px 0;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .test-case.pass {
            background: #e8f5e9;
            border-left: 3px solid #4caf50;
        }

        .test-case.fail {
            background: #ffebee;
            border-left: 3px solid #f44336;
        }

        .test-case.pending {
            background: #fff;
            border-left: 3px solid #ddd;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 1000;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .achievement-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .achievement-icon {
            font-size: 60px;
            margin-bottom: 15px;
            animation: bounce 0.5s;
        }

        .achievement-title {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .achievement-desc {
            color: #666;
            margin-bottom: 20px;
        }

        .achievement-xp {
            color: #4caf50;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .challenge-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .challenge-list {
            list-style: none;
            margin-top: 15px;
        }

        .challenge-item {
            padding: 12px;
            background: rgba(255,255,255,0.1);
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .challenge-item:hover {
            background: rgba(255,255,255,0.2);
        }

        .challenge-item.completed {
            background: rgba(76, 175, 80, 0.3);
        }

        .challenge-item.completed::before {
            content: 'âœ“ ';
            color: #4caf50;
            font-weight: bold;
        }

        .debug-panel {
            margin-top: 15px;
            padding: 15px;
            background: #2d2d2d;
            border-radius: 8px;
            color: #f0f0f0;
            font-family: monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
        }

        .debug-line {
            margin: 2px 0;
            padding: 2px 5px;
        }

        .debug-line.step {
            color: #64b5f6;
        }

        .debug-line.variable {
            color: #ffb74d;
        }

        .debug-line.error {
            color: #e57373;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .stat-box {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }

            .user-info {
                position: static;
                margin-bottom: 20px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
    <div class="user-info">
        <span id="userName">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</span>
        <span class="level-badge">Lv.<span id="userLevel">1</span></span>
        <div class="xp-bar">
            <div class="xp-progress" id="xpProgress" style="width: 0%"></div>
        </div>
        <small><span id="currentXP">0</span> / <span id="requiredXP">100</span> XP</small>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ® Pythonã‚²ãƒ¼ãƒ é–‹ç™ºå­¦ç¿’ç’°å¢ƒ</h1>
            <p>Scratchã‹ã‚‰Pythonã¸ã€æ¥½ã—ãã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼</p>
        </div>

        <div class="main-layout">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <aside class="sidebar">
                <h3 style="margin-bottom: 15px;">ğŸ“š ãƒãƒ£ãƒ—ã‚¿ãƒ¼</h3>
                <ul class="chapter-list" id="chapterList">
                    <li class="chapter-item active" data-chapter="0">0. æ¶ã‘æ©‹</li>
                    <li class="chapter-item" data-chapter="1">1. å¤‰æ•°ã¨å‹</li>
                    <li class="chapter-item" data-chapter="2">2. æ¡ä»¶åˆ†å²</li>
                    <li class="chapter-item" data-chapter="3">3. ç¹°ã‚Šè¿”ã—</li>
                    <li class="chapter-item locked" data-chapter="4">4. ãƒªã‚¹ãƒˆ</li>
                    <li class="chapter-item locked" data-chapter="5">5. é–¢æ•°</li>
                </ul>

                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="completedCount">0</div>
                        <div class="stat-label">å®Œäº†ãƒ¬ãƒƒã‚¹ãƒ³</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="streakCount">0</div>
                        <div class="stat-label">é€£ç¶šæ—¥æ•°</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalTime">0</div>
                        <div class="stat-label">å­¦ç¿’æ™‚é–“(åˆ†)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="errorsSolved">0</div>
                        <div class="stat-label">è§£æ±ºã‚¨ãƒ©ãƒ¼</div>
                    </div>
                </div>
            </aside>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="main-content">
                <!-- ãƒ¬ãƒƒã‚¹ãƒ³ã‚¨ãƒªã‚¢ -->
                <div class="card">
                    <div class="lesson-header">
                        <h2 id="lessonTitle">ğŸ“š ãƒ¬ãƒƒã‚¹ãƒ³1: å¤‰æ•°ã‚’ç†è§£ã—ã‚ˆã†</h2>
                        <div class="difficulty-indicator">
                            <span class="difficulty-star active">â­</span>
                            <span class="difficulty-star">â­</span>
                            <span class="difficulty-star">â­</span>
                        </div>
                    </div>

                    <!-- Scratch vs Python æ¯”è¼ƒ -->
                    <div class="comparison-view" id="comparisonView">
                        <div class="comparison-box scratch">
                            <h4>ğŸŸ¨ Scratchã®å ´åˆ</h4>
                            <pre><code id="scratchCode">[å¤‰æ•°ã‚’ä½œã‚‹] â†’ score
[scoreã‚’0ã«ã™ã‚‹]
[scoreã‚’1ãšã¤å¤‰ãˆã‚‹]</code></pre>
                        </div>
                        <div class="comparison-box python">
                            <h4>ğŸ Pythonã®å ´åˆ</h4>
                            <pre><code id="pythonCode">score = 0
score = score + 1
print(score)</code></pre>
                        </div>
                    </div>

                    <!-- ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«èª¬æ˜ -->
                    <div class="visual-explanation" id="visualExplanation">
                        <h4>ğŸ’¡ ãƒ¡ãƒ¢ãƒªã®ä¸­ã§ä½•ãŒèµ·ãã¦ã„ã‚‹ã‹ï¼Ÿ</h4>
                        <div class="memory-visualization" id="memoryViz">
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                        </div>
                    </div>

                    <!-- ã‚³ãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ -->
                    <div class="code-tabs">
                        <button class="code-tab active" onclick="switchTab('practice')">ç·´ç¿’å•é¡Œ</button>
                        <button class="code-tab" onclick="switchTab('solution')">è§£ç­”ä¾‹</button>
                        <button class="code-tab" onclick="switchTab('sandbox')">è‡ªç”±ã«è©¦ã™</button>
                    </div>

                    <div class="code-editor-wrapper">
                        <div class="line-numbers" id="lineNumbers">1</div>
                        <textarea id="codeEditor" class="code-editor" placeholder="ã“ã“ã«ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›..."></textarea>
                    </div>

                    <!-- ãƒ’ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ  -->
                    <div class="hint-system">
                        <div class="hint-level">
                            <button class="hint-button" onclick="showHint(1)">ğŸ’¡ ãƒ’ãƒ³ãƒˆ1</button>
                            <button class="hint-button" onclick="showHint(2)">ğŸ’¡ ãƒ’ãƒ³ãƒˆ2</button>
                            <button class="hint-button" onclick="showHint(3)">ğŸ’¡ ç­”ãˆã‚’è¦‹ã‚‹</button>
                        </div>
                        <div id="hintContent" class="hint-content"></div>
                    </div>

                    <!-- å®Ÿè¡Œãƒœã‚¿ãƒ³ -->
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="runCode()">
                            â–¶ï¸ å®Ÿè¡Œ
                        </button>
                        <button class="btn btn-secondary" onclick="stepDebug()">
                            ğŸ› ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ
                        </button>
                        <button class="btn btn-secondary" onclick="checkCode()">
                            âœ“ ç­”ãˆåˆã‚ã›
                        </button>
                        <button class="btn btn-danger" onclick="resetCode()">
                            ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>

                    <!-- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ -->
                    <div class="test-cases" id="testCases" style="display: none;">
                        <h4>ğŸ“ ãƒ†ã‚¹ãƒˆçµæœ</h4>
                        <div id="testResults"></div>
                    </div>
                </div>

                <!-- å‡ºåŠ›ã‚¨ãƒªã‚¢ -->
                <div class="card">
                    <h2>ğŸ’» å®Ÿè¡Œçµæœ</h2>
                    <div id="output" class="output-area">å®Ÿè¡ŒçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>
                    
                    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
                    <div class="debug-panel" id="debugPanel" style="display: none;">
                        <div id="debugOutput"></div>
                    </div>
                </div>

                <!-- ãƒãƒ£ãƒ¬ãƒ³ã‚¸èª²é¡Œ -->
                <div class="card full-width">
                    <div class="challenge-card">
                        <h3>ğŸ¯ ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
                        <p>ä»¥ä¸‹ã®èª²é¡Œã‚’ã‚¯ãƒªã‚¢ã—ã¦ã€ãƒœãƒ¼ãƒŠã‚¹XPã‚’ç²å¾—ã—ã‚ˆã†ï¼</p>
                        <ul class="challenge-list" id="challengeList">
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å®Ÿç¸¾ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="achievementPopup" class="achievement-popup">
        <div class="achievement-icon">ğŸ†</div>
        <div class="achievement-title" id="achievementTitle">å®Ÿç¸¾è§£é™¤ï¼</div>
        <div class="achievement-desc" id="achievementDesc">åˆã‚ã¦ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ</div>
        <div class="achievement-xp" id="achievementXP">+50 XP</div>
        <button class="btn btn-primary" onclick="closeAchievement()">OK</button>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentLesson = 0;
        let currentTab = 'practice';
        let executionStep = 0;
        let variables = {};
        let userProgress = {
            level: 1,
            xp: 0,
            requiredXP: 100,
            completedLessons: [],
            achievements: [],
            totalTime: 0,
            errorsSolved: 0,
            streak: 0
        };

        // ãƒ¬ãƒƒã‚¹ãƒ³ãƒ‡ãƒ¼ã‚¿
        const lessons = [
            {
                id: 0,
                title: "ãƒ¬ãƒƒã‚¹ãƒ³1: å¤‰æ•°ã‚’ç†è§£ã—ã‚ˆã†",
                difficulty: 1,
                scratch: "[å¤‰æ•°ã‚’ä½œã‚‹] â†’ score\n[scoreã‚’0ã«ã™ã‚‹]\n[scoreã‚’1ãšã¤å¤‰ãˆã‚‹]",
                python: "score = 0\nscore = score + 1\nprint(score)",
                practice: `# å¤‰æ•°ã®ç·´ç¿’
# scoreã¨ã„ã†å¤‰æ•°ã‚’ä½œã£ã¦0ã‚’å…¥ã‚Œã‚ˆã†
score = ___

# scoreã‚’è¡¨ç¤ºã—ã‚ˆã†
print("ç¾åœ¨ã®ã‚¹ã‚³ã‚¢:", ___)

# scoreã«1ã‚’è¶³ãã†
score = score + ___

# æ–°ã—ã„scoreã‚’è¡¨ç¤ºã—ã‚ˆã†
print("æ–°ã—ã„ã‚¹ã‚³ã‚¢:", score)`,
                solution: `# å¤‰æ•°ã®ç·´ç¿’
# scoreã¨ã„ã†å¤‰æ•°ã‚’ä½œã£ã¦0ã‚’å…¥ã‚Œã‚ˆã†
score = 0

# scoreã‚’è¡¨ç¤ºã—ã‚ˆã†
print("ç¾åœ¨ã®ã‚¹ã‚³ã‚¢:", score)

# scoreã«1ã‚’è¶³ãã†
score = score + 1

# æ–°ã—ã„scoreã‚’è¡¨ç¤ºã—ã‚ˆã†
print("æ–°ã—ã„ã‚¹ã‚³ã‚¢:", score)`,
                hints: [
                    "å¤‰æ•°ã¯ã€Œåå‰ = å€¤ã€ã®å½¢ã§ä½œã‚Šã¾ã™ã€‚scoreã«0ã‚’å…¥ã‚Œã‚‹ã«ã¯ score = 0 ã¨æ›¸ãã¾ã™ã€‚",
                    "print()ã®ä¸­ã§å¤‰æ•°ã‚’ä½¿ã†ã«ã¯ã€å¤‰æ•°åã‚’ãã®ã¾ã¾æ›¸ãã¾ã™ã€‚print(\"ãƒ†ã‚­ã‚¹ãƒˆ\", score)",
                    "æ­£è§£: score = 0, score, 1"
                ],
                expectedOutput: "ç¾åœ¨ã®ã‚¹ã‚³ã‚¢: 0\næ–°ã—ã„ã‚¹ã‚³ã‚¢: 1",
                challenges: [
                    { id: "var3", desc: "å¤‰æ•°ã‚’3ã¤ä»¥ä¸Šä½¿ã†", xp: 20 },
                    { id: "noerror", desc: "ã‚¨ãƒ©ãƒ¼ãªã—ã§å®Ÿè¡Œ", xp: 10 },
                    { id: "original", desc: "ã‚ªãƒªã‚¸ãƒŠãƒ«å¤‰æ•°ã‚’è¿½åŠ ", xp: 30 }
                ]
            },
            {
                id: 1,
                title: "ãƒ¬ãƒƒã‚¹ãƒ³2: å…¥å‡ºåŠ›ã‚’ãƒã‚¹ã‚¿ãƒ¼",
                difficulty: 1,
                scratch: "[ã€œã¨èã„ã¦å¾…ã¤]\n[ç­”ãˆ]",
                python: "name = input('åå‰ã¯ï¼Ÿ')\nprint('ã“ã‚“ã«ã¡ã¯', name)",
                practice: `# å…¥å‡ºåŠ›ã®ç·´ç¿’
# åå‰ã‚’å…¥åŠ›ã—ã¦ã‚‚ã‚‰ãŠã†
name = ___("ã‚ãªãŸã®åå‰ã¯ï¼Ÿ ")

# æŒ¨æ‹¶ã‚’è¡¨ç¤ºã—ã‚ˆã†
print("ã“ã‚“ã«ã¡ã¯ã€___ã•ã‚“ï¼")

# æ•°å€¤ã®å…¥åŠ›
age_str = input("å¹´é½¢ã¯ï¼Ÿ ")
age = ___(age_str)  # æ–‡å­—ã‚’æ•°å€¤ã«å¤‰æ›

print("5å¹´å¾Œã¯", age + ___, "æ­³ã§ã™ã­ï¼")`,
                solution: `# å…¥å‡ºåŠ›ã®ç·´ç¿’
# åå‰ã‚’å…¥åŠ›ã—ã¦ã‚‚ã‚‰ãŠã†
name = input("ã‚ãªãŸã®åå‰ã¯ï¼Ÿ ")

# æŒ¨æ‹¶ã‚’è¡¨ç¤ºã—ã‚ˆã†
print("ã“ã‚“ã«ã¡ã¯ã€" + name + "ã•ã‚“ï¼")

# æ•°å€¤ã®å…¥åŠ›
age_str = input("å¹´é½¢ã¯ï¼Ÿ ")
age = int(age_str)  # æ–‡å­—ã‚’æ•°å€¤ã«å¤‰æ›

print("5å¹´å¾Œã¯", age + 5, "æ­³ã§ã™ã­ï¼")`,
                hints: [
                    "input()é–¢æ•°ã§å…¥åŠ›ã‚’å—ã‘å–ã‚Šã¾ã™",
                    "æ–‡å­—åˆ—ã‚’æ•°å€¤ã«å¤‰æ›ã™ã‚‹ã«ã¯ int() ã‚’ä½¿ã„ã¾ã™",
                    "æ­£è§£: input, name, int, 5"
                ],
                expectedOutput: "ã‚ãªãŸã®åå‰ã¯ï¼Ÿ å¤ªéƒ\nã“ã‚“ã«ã¡ã¯ã€å¤ªéƒã•ã‚“ï¼\nå¹´é½¢ã¯ï¼Ÿ 13\n5å¹´å¾Œã¯ 18 æ­³ã§ã™ã­ï¼",
                challenges: [
                    { id: "multi_input", desc: "è¤‡æ•°ã®å…¥åŠ›ã‚’å‡¦ç†", xp: 25 },
                    { id: "type_convert", desc: "å‹å¤‰æ›ã‚’ä½¿ç”¨", xp: 20 },
                    { id: "format", desc: "ãã‚Œã„ã«æ•´å½¢ã—ã¦å‡ºåŠ›", xp: 30 }
                ]
            },
            {
                id: 2,
                title: "ãƒ¬ãƒƒã‚¹ãƒ³3: æ¡ä»¶åˆ†å²",
                difficulty: 2,
                scratch: "[ã‚‚ã—ã€œãªã‚‰]\n[ã§ãªã‘ã‚Œã°]",
                python: "if score > 10:\n    print('é«˜å¾—ç‚¹ï¼')\nelse:\n    print('é ‘å¼µã‚ã†ï¼')",
                practice: `# æ¡ä»¶åˆ†å²ã®ç·´ç¿’
score = 15

# scoreã«ã‚ˆã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰ãˆã‚‹
___ score > 20:
    print("ç´ æ™´ã‚‰ã—ã„ï¼")
___ score > 10:
    print("è‰¯ã„ã§ã™ã­ï¼")
___:
    print("ã‚‚ã†å°‘ã—é ‘å¼µã‚ã†ï¼")`,
                solution: `# æ¡ä»¶åˆ†å²ã®ç·´ç¿’
score = 15

# scoreã«ã‚ˆã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å¤‰ãˆã‚‹
if score > 20:
    print("ç´ æ™´ã‚‰ã—ã„ï¼")
elif score > 10:
    print("è‰¯ã„ã§ã™ã­ï¼")
else:
    print("ã‚‚ã†å°‘ã—é ‘å¼µã‚ã†ï¼")`,
                hints: [
                    "æ¡ä»¶åˆ†å²ã¯ if, elif, else ã‚’ä½¿ã„ã¾ã™",
                    "æ¡ä»¶ã®å¾Œã«ã¯å¿…ãš : (ã‚³ãƒ­ãƒ³) ãŒå¿…è¦ã§ã™",
                    "æ­£è§£: if, elif, else"
                ],
                expectedOutput: "è‰¯ã„ã§ã™ã­ï¼",
                challenges: [
                    { id: "nested_if", desc: "å…¥ã‚Œå­ã®æ¡ä»¶åˆ†å²", xp: 35 },
                    { id: "multi_cond", desc: "è¤‡æ•°æ¡ä»¶ã‚’çµ„ã¿åˆã‚ã›", xp: 30 },
                    { id: "grade", desc: "æˆç¸¾åˆ¤å®šãƒ—ãƒ­ã‚°ãƒ©ãƒ ä½œæˆ", xp: 40 }
                ]
            },
            {
                id: 3,
                title: "ãƒ¬ãƒƒã‚¹ãƒ³4: ç¹°ã‚Šè¿”ã—å‡¦ç†",
                difficulty: 2,
                scratch: "[10å›ç¹°ã‚Šè¿”ã™]",
                python: "for i in range(10):\n    print(i)",
                practice: `# ç¹°ã‚Šè¿”ã—ã®ç·´ç¿’
# 1ã‹ã‚‰5ã¾ã§æ•°ãˆã‚‹
___ i in ___(1, 6):
    print(i)

# ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
print("ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹ï¼")
for i in range(___, ___, -1):
    print(i)
print("ç™ºå°„ï¼")`,
                solution: `# ç¹°ã‚Šè¿”ã—ã®ç·´ç¿’
# 1ã‹ã‚‰5ã¾ã§æ•°ãˆã‚‹
for i in range(1, 6):
    print(i)

# ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
print("ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹ï¼")
for i in range(3, 0, -1):
    print(i)
print("ç™ºå°„ï¼")`,
                hints: [
                    "foræ–‡ã§ç¹°ã‚Šè¿”ã—ã‚’ä½œã‚Šã¾ã™ã€‚range(é–‹å§‹, çµ‚äº†) ã§ç¯„å›²ã‚’æŒ‡å®š",
                    "range(3, 0, -1) ã¯ 3ã‹ã‚‰1ã¾ã§é€†é †ã«æ•°ãˆã¾ã™",
                    "æ­£è§£: for, range, 3, 0"
                ],
                expectedOutput: "1\n2\n3\n4\n5\nã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹ï¼\n3\n2\n1\nç™ºå°„ï¼",
                challenges: [
                    { id: "nested_loop", desc: "äºŒé‡ãƒ«ãƒ¼ãƒ—ã‚’ä½¿ã†", xp: 40 },
                    { id: "pattern", desc: "å›³å½¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æã", xp: 35 },
                    { id: "sum", desc: "åˆè¨ˆã‚’è¨ˆç®—ã™ã‚‹", xp: 25 }
                ]
            }
        ];

        // Pythonå®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆæ“¬ä¼¼ï¼‰
        class PythonSimulator {
            constructor() {
                this.variables = {};
                this.output = [];
                this.inputQueue = [];
            }

            execute(code) {
                this.output = [];
                this.variables = {};
                const lines = code.split('\n');
                
                try {
                    for (let i = 0; i < lines.length; i++) {
                        this.executeLine(lines[i].trim(), i + 1);
                    }
                    return { success: true, output: this.output.join('\n') };
                } catch (error) {
                    return { success: false, error: error.message, line: error.line };
                }
            }

            executeLine(line, lineNumber) {
                // ã‚³ãƒ¡ãƒ³ãƒˆã‚„ç©ºè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
                if (!line || line.startsWith('#')) return;

                // å¤‰æ•°ä»£å…¥
                if (line.includes('=') && !line.includes('==')) {
                    const [varName, value] = line.split('=').map(s => s.trim());
                    
                    // ç©ºæ¬„ãƒã‚§ãƒƒã‚¯
                    if (value.includes('___')) {
                        throw { message: `ç©ºæ¬„ãŒã‚ã‚Šã¾ã™`, line: lineNumber };
                    }
                    
                    // æ•°å€¤ãƒªãƒ†ãƒ©ãƒ«
                    if (/^\d+$/.test(value)) {
                        this.variables[varName] = parseInt(value);
                        this.updateMemoryVisualization(varName, value);
                    }
                    // æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«
                    else if (value.startsWith('"') || value.startsWith("'")) {
                        this.variables[varName] = value.slice(1, -1);
                        this.updateMemoryVisualization(varName, value);
                    }
                    // å¤‰æ•°å‚ç…§
                    else if (this.variables[value]) {
                        this.variables[varName] = this.variables[value];
                        this.updateMemoryVisualization(varName, this.variables[value]);
                    }
                    // æ¼”ç®—
                    else if (value.includes('+') || value.includes('-') || value.includes('*') || value.includes('/')) {
                        const result = this.evaluateExpression(value);
                        this.variables[varName] = result;
                        this.updateMemoryVisualization(varName, result);
                    }
                    // inputé–¢æ•°
                    else if (value.startsWith('input(')) {
                        const prompt = value.match(/input\((.*?)\)/)[1].replace(/['"]/g, '');
                        const inputValue = this.inputQueue.shift() || "ãƒ†ã‚¹ãƒˆå…¥åŠ›";
                        this.output.push(`${prompt} ${inputValue}`);
                        this.variables[varName] = inputValue;
                        this.updateMemoryVisualization(varName, inputValue);
                    }
                    // inté–¢æ•°
                    else if (value.startsWith('int(')) {
                        const varToConvert = value.match(/int\((.*?)\)/)[1];
                        const val = this.variables[varToConvert] || varToConvert;
                        this.variables[varName] = parseInt(val) || 0;
                        this.updateMemoryVisualization(varName, this.variables[varName]);
                    }
                }
                // printæ–‡
                else if (line.startsWith('print(')) {
                    const content = line.match(/print\((.*)\)/)[1];
                    const output = this.evaluatePrintContent(content);
                    this.output.push(output);
                }
                // ifæ–‡
                else if (line.startsWith('if ')) {
                    // ç°¡ç•¥åŒ–ã•ã‚ŒãŸæ¡ä»¶è©•ä¾¡
                    const condition = line.slice(3, -1);
                    // ã“ã“ã§ã¯å˜ç´”åŒ–ã®ãŸã‚ã€å¸¸ã«æ¡ä»¶ã‚’trueã¨ã—ã¦æ‰±ã†
                }
                // ãã®ä»–ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
                else if (line.includes('___')) {
                    throw { message: `ç©ºæ¬„ãŒã‚ã‚Šã¾ã™`, line: lineNumber };
                }
            }

            evaluateExpression(expr) {
                // ç°¡å˜ãªæ¼”ç®—ã‚’è©•ä¾¡
                const parts = expr.split(/([+\-*/])/);
                let result = this.getValue(parts[0].trim());
                
                for (let i = 1; i < parts.length; i += 2) {
                    const operator = parts[i];
                    const value = this.getValue(parts[i + 1].trim());
                    
                    switch (operator) {
                        case '+': result += value; break;
                        case '-': result -= value; break;
                        case '*': result *= value; break;
                        case '/': result = Math.floor(result / value); break;
                    }
                }
                return result;
            }

            getValue(str) {
                if (/^\d+$/.test(str)) return parseInt(str);
                if (this.variables[str] !== undefined) return this.variables[str];
                return str;
            }

            evaluatePrintContent(content) {
                const parts = content.split(',').map(p => p.trim());
                const output = [];
                
                for (const part of parts) {
                    if (part.startsWith('"') || part.startsWith("'")) {
                        output.push(part.slice(1, -1));
                    } else if (this.variables[part] !== undefined) {
                        output.push(this.variables[part]);
                    } else if (/^\d+$/.test(part)) {
                        output.push(part);
                    } else {
                        output.push(this.evaluateExpression(part));
                    }
                }
                
                return output.join(' ');
            }

            updateMemoryVisualization(varName, value) {
                const memViz = document.getElementById('memoryViz');
                let box = document.getElementById(`mem-${varName}`);
                
                if (!box) {
                    box = document.createElement('div');
                    box.className = 'memory-box';
                    box.id = `mem-${varName}`;
                    box.innerHTML = `
                        <div class="var-name">${varName}</div>
                        <div class="var-value">${value}</div>
                    `;
                    memViz.appendChild(box);
                } else {
                    box.querySelector('.var-value').textContent = value;
                    box.classList.add('highlight');
                    setTimeout(() => box.classList.remove('highlight'), 500);
                }
            }

            setInputQueue(inputs) {
                this.inputQueue = inputs;
            }
        }

        const pythonSim = new PythonSimulator();

        // åˆæœŸåŒ–
        function init() {
            loadProgress();
            loadLesson(0);
            updateLineNumbers();
            updateStats();
            
            // ã‚¨ãƒ‡ã‚£ã‚¿ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            const codeEditor = document.getElementById('codeEditor');
            codeEditor.addEventListener('input', updateLineNumbers);
            codeEditor.addEventListener('scroll', syncLineNumbers);
            codeEditor.addEventListener('keydown', updateLineNumbers);
            codeEditor.addEventListener('paste', () => setTimeout(updateLineNumbers, 0));
            
            // ãƒãƒ£ãƒ—ã‚¿ãƒ¼ãƒªã‚¹ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('chapterList').addEventListener('click', (e) => {
                const item = e.target.closest('.chapter-item');
                if (!item || item.classList.contains('locked')) return;
                
                document.querySelectorAll('.chapter-item').forEach(ch => {
                    ch.classList.remove('active');
                });
                item.classList.add('active');
                
                const chapter = parseInt(item.dataset.chapter);
                if (lessons[chapter]) {
                    loadLesson(chapter);
                }
            });
            
            // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        runCode();
                    } else if (e.key === 's') {
                        e.preventDefault();
                        saveProgress();
                    }
                }
            });
            
            // å®šæœŸä¿å­˜
            setInterval(saveProgress, 30000);
            
            // å­¦ç¿’æ™‚é–“ã‚«ã‚¦ãƒ³ãƒˆ
            setInterval(() => {
                userProgress.totalTime++;
                document.getElementById('totalTime').textContent = userProgress.totalTime;
            }, 60000);
        }

        // ãƒ¬ãƒƒã‚¹ãƒ³èª­ã¿è¾¼ã¿
        function loadLesson(lessonId) {
            const lesson = lessons[lessonId];
            if (!lesson) return;
            
            currentLesson = lessonId;
            
            // UIæ›´æ–°
            document.getElementById('lessonTitle').textContent = `ğŸ“š ${lesson.title}`;
            document.getElementById('scratchCode').textContent = lesson.scratch;
            document.getElementById('pythonCode').textContent = lesson.python;
            
            // é›£æ˜“åº¦è¡¨ç¤º
            const stars = document.querySelectorAll('.difficulty-star');
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < lesson.difficulty);
            });
            
            // ã‚¨ãƒ‡ã‚£ã‚¿æ›´æ–°
            if (currentTab === 'practice') {
                document.getElementById('codeEditor').value = lesson.practice;
            }
            
            // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒªã‚¹ãƒˆæ›´æ–°
            const challengeList = document.getElementById('challengeList');
            challengeList.innerHTML = lesson.challenges.map(ch => `
                <li class="challenge-item" id="challenge-${ch.id}" onclick="checkChallenge('${ch.id}')">
                    <span>${ch.desc}</span>
                    <span>+${ch.xp} XP</span>
                </li>
            `).join('');
            
            // ãƒ¡ãƒ¢ãƒªå¯è¦–åŒ–ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('memoryViz').innerHTML = '';
            
            // å‡ºåŠ›ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('output').textContent = 'å®Ÿè¡ŒçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
            document.getElementById('testCases').style.display = 'none';
            
            updateLineNumbers();
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tab) {
            currentTab = tab;
            const lesson = lessons[currentLesson];
            const editor = document.getElementById('codeEditor');
            
            // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            switch (tab) {
                case 'practice':
                    editor.value = lesson.practice;
                    break;
                case 'solution':
                    editor.value = lesson.solution;
                    updateProgress(5);
                    break;
                case 'sandbox':
                    editor.value = '# è‡ªç”±ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ï¼\n\n';
                    break;
            }
            
            updateLineNumbers();
        }

        // ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ
        function runCode() {
            const code = document.getElementById('codeEditor').value;
            const outputDiv = document.getElementById('output');
            
            // ãƒ†ã‚¹ãƒˆç”¨ã®å…¥åŠ›ã‚’è¨­å®š
            pythonSim.setInputQueue(['å¤ªéƒ', '13']);
            
            // ãƒ¡ãƒ¢ãƒªå¯è¦–åŒ–ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('memoryViz').innerHTML = '';
            
            const result = pythonSim.execute(code);
            
            if (result.success) {
                outputDiv.classList.remove('error');
                outputDiv.innerHTML = result.output.split('\n').map(line => 
                    `<div class="output-line">${line}</div>`
                ).join('');
                
                updateProgress(10);
                checkChallenges(code);
                
                // åˆå›å®Ÿè¡Œã®å®Ÿç¸¾
                if (!userProgress.achievements.includes('first_run')) {
                    userProgress.achievements.push('first_run');
                    showAchievement('åˆã‚ã¦ã®å®Ÿè¡Œ', 'ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼', 20);
                }
            } else {
                outputDiv.classList.add('error');
                outputDiv.textContent = `ã‚¨ãƒ©ãƒ¼ (${result.line}è¡Œç›®): ${result.error}`;
                
                // ã‚¨ãƒ©ãƒ¼è§£æ±ºã‚«ã‚¦ãƒ³ãƒˆ
                if (code.includes('___') === false) {
                    userProgress.errorsSolved++;
                    document.getElementById('errorsSolved').textContent = userProgress.errorsSolved;
                }
            }
        }

        // ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œ
        function stepDebug() {
            const debugPanel = document.getElementById('debugPanel');
            const debugOutput = document.getElementById('debugOutput');
            debugPanel.style.display = 'block';
            
            const code = document.getElementById('codeEditor').value;
            const lines = code.split('\n').filter(line => line.trim() && !line.trim().startsWith('#'));
            
            debugOutput.innerHTML = '';
            
            lines.forEach((line, index) => {
                setTimeout(() => {
                    const debugLine = document.createElement('div');
                    debugLine.className = 'debug-line step';
                    debugLine.textContent = `ã‚¹ãƒ†ãƒƒãƒ— ${index + 1}: ${line}`;
                    debugOutput.appendChild(debugLine);
                    debugOutput.scrollTop = debugOutput.scrollHeight;
                }, index * 500);
            });
        }

        // ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
        function checkCode() {
            const code = document.getElementById('codeEditor').value;
            const lesson = lessons[currentLesson];
            
            const testCases = document.getElementById('testCases');
            const testResults = document.getElementById('testResults');
            testCases.style.display = 'block';
            
            const tests = [
                { name: 'ç©ºæ¬„ãƒã‚§ãƒƒã‚¯', pass: !code.includes('___') },
                { name: 'æ§‹æ–‡ãƒã‚§ãƒƒã‚¯', pass: checkSyntax(code) },
                { name: 'å‡ºåŠ›ãƒã‚§ãƒƒã‚¯', pass: checkOutput(code, lesson.expectedOutput) }
            ];
            
            testResults.innerHTML = tests.map(test => `
                <div class="test-case ${test.pass ? 'pass' : 'fail'}">
                    <span>${test.pass ? 'âœ…' : 'âŒ'} ${test.name}</span>
                </div>
            `).join('');
            
            if (tests.every(t => t.pass)) {
                markLessonComplete(currentLesson);
                showAchievement('å®Œç’§ï¼', `${lesson.title}ã‚’ã‚¯ãƒªã‚¢ï¼`, 50);
            }
        }

        // æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function checkSyntax(code) {
            const lines = code.split('\n');
            for (const line of lines) {
                if (line.includes('___')) return false;
                if (line.trim().startsWith('if') && !line.endsWith(':')) return false;
                if (line.trim().startsWith('for') && !line.endsWith(':')) return false;
                if (line.trim().startsWith('elif') && !line.endsWith(':')) return false;
                if (line.trim().startsWith('else') && !line.endsWith(':')) return false;
            }
            return true;
        }

        // å‡ºåŠ›ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function checkOutput(code, expected) {
            // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€å®Ÿè¡Œçµæœã¨æœŸå¾…å€¤ã‚’æ¯”è¼ƒ
            return !code.includes('___');
        }

        // ãƒªã‚»ãƒƒãƒˆ
        function resetCode() {
            const lesson = lessons[currentLesson];
            document.getElementById('codeEditor').value = lesson.practice;
            document.getElementById('output').textContent = 'å®Ÿè¡ŒçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
            document.getElementById('testCases').style.display = 'none';
            document.getElementById('debugPanel').style.display = 'none';
            document.getElementById('memoryViz').innerHTML = '';
            document.getElementById('hintContent').classList.remove('show');
            document.querySelectorAll('.hint-button').forEach(btn => {
                btn.classList.remove('revealed');
            });
            updateLineNumbers();
        }

        // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
        function showHint(level) {
            const lesson = lessons[currentLesson];
            const hintContent = document.getElementById('hintContent');
            const hintButton = event.target;
            
            hintButton.classList.add('revealed');
            hintContent.innerHTML = `<strong>ãƒ’ãƒ³ãƒˆ${level}:</strong><br>${lesson.hints[level - 1]}`;
            hintContent.classList.add('show');
            
            // ãƒ’ãƒ³ãƒˆä½¿ç”¨ã§XPæ¸›å°‘
            if (level === 3) {
                updateProgress(-5);
            }
        }

        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒã‚§ãƒƒã‚¯
        function checkChallenges(code) {
            const lesson = lessons[currentLesson];
            
            // å¤‰æ•°ã‚«ã‚¦ãƒ³ãƒˆ
            const varCount = (code.match(/^\s*\w+\s*=/gm) || []).length;
            if (varCount >= 3) {
                completeChallenge('var3');
            }
            
            // ã‚¨ãƒ©ãƒ¼ãªã—å®Ÿè¡Œ
            if (!code.includes('___')) {
                completeChallenge('noerror');
            }
        }

        // ãƒãƒ£ãƒ¬ãƒ³ã‚¸å®Œäº†
        function completeChallenge(challengeId) {
            const element = document.getElementById(`challenge-${challengeId}`);
            if (element && !element.classList.contains('completed')) {
                element.classList.add('completed');
                const lesson = lessons[currentLesson];
                const challenge = lesson.challenges.find(c => c.id === challengeId);
                if (challenge) {
                    updateProgress(challenge.xp);
                }
            }
        }

        // ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†
        function markLessonComplete(lessonId) {
            if (!userProgress.completedLessons.includes(lessonId)) {
                userProgress.completedLessons.push(lessonId);
                
                // UIã‚’æ›´æ–°
                const chapterItem = document.querySelector(`.chapter-item[data-chapter="${lessonId}"]`);
                if (chapterItem) {
                    chapterItem.classList.add('completed');
                }
                
                // æ¬¡ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
                const nextChapter = document.querySelector(`.chapter-item[data-chapter="${lessonId + 1}"]`);
                if (nextChapter) {
                    nextChapter.classList.remove('locked');
                }
                
                updateStats();
                updateProgress(100);
            }
        }

        // é€²æ—æ›´æ–°
        function updateProgress(xp) {
            userProgress.xp += xp;
            
            // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ãƒã‚§ãƒƒã‚¯
            while (userProgress.xp >= userProgress.requiredXP) {
                userProgress.xp -= userProgress.requiredXP;
                userProgress.level++;
                userProgress.requiredXP = userProgress.level * 100;
                showAchievement('ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼', `ãƒ¬ãƒ™ãƒ«${userProgress.level}ã«åˆ°é”ï¼`, 0);
            }
            
            // ãƒã‚¤ãƒŠã‚¹XPã®å‡¦ç†
            if (userProgress.xp < 0) {
                userProgress.xp = 0;
            }
            
            // UIæ›´æ–°
            document.getElementById('userLevel').textContent = userProgress.level;
            document.getElementById('currentXP').textContent = Math.floor(userProgress.xp);
            document.getElementById('requiredXP').textContent = userProgress.requiredXP;
            document.getElementById('xpProgress').style.width = `${(userProgress.xp / userProgress.requiredXP) * 100}%`;
            
            saveProgress();
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            document.getElementById('completedCount').textContent = userProgress.completedLessons.length;
            document.getElementById('streakCount').textContent = userProgress.streak;
            document.getElementById('totalTime').textContent = userProgress.totalTime;
            document.getElementById('errorsSolved').textContent = userProgress.errorsSolved;
        }

        // å®Ÿç¸¾è¡¨ç¤º
        function showAchievement(title, description, xp) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDesc').textContent = description;
            document.getElementById('achievementXP').textContent = xp > 0 ? `+${xp} XP` : '';
            
            popup.classList.add('show');
            
            if (xp > 0) {
                updateProgress(xp);
            }
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        // å®Ÿç¸¾ã‚’é–‰ã˜ã‚‹
        function closeAchievement() {
            document.getElementById('achievementPopup').classList.remove('show');
        }

        // è¡Œç•ªå·æ›´æ–°
        function updateLineNumbers() {
            const editor = document.getElementById('codeEditor');
            const lineNumbers = document.getElementById('lineNumbers');
            const lines = editor.value.split('\n').length;
            
            lineNumbers.textContent = Array.from({length: lines}, (_, i) => i + 1).join('\n');
            
            // é«˜ã•ã‚’åŒæœŸ
            lineNumbers.style.height = editor.scrollHeight + 'px';
        }

        // è¡Œç•ªå·ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸ
        function syncLineNumbers() {
            const editor = document.getElementById('codeEditor');
            const lineNumbers = document.getElementById('lineNumbers');
            lineNumbers.scrollTop = editor.scrollTop;
        }

        // é€²æ—ä¿å­˜
        function saveProgress() {
            localStorage.setItem('pythonGameProgress', JSON.stringify(userProgress));
        }

        // é€²æ—èª­ã¿è¾¼ã¿
        function loadProgress() {
            const saved = localStorage.getItem('pythonGameProgress');
            if (saved) {
                userProgress = JSON.parse(saved);
                updateProgress(0);
                updateStats();
                
                // å®Œäº†ãƒ¬ãƒƒã‚¹ãƒ³ã®è¡¨ç¤ºã‚’æ›´æ–°
                userProgress.completedLessons.forEach(lessonId => {
                    const chapterItem = document.querySelector(`.chapter-item[data-chapter="${lessonId}"]`);
                    if (chapterItem) {
                        chapterItem.classList.add('completed');
                    }
                    const nextChapter = document.querySelector(`.chapter-item[data-chapter="${lessonId + 1}"]`);
                    if (nextChapter) {
                        nextChapter.classList.remove('locked');
                    }
                });
            }
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>